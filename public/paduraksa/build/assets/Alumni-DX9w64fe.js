import{r as s,b as x,j as a,c as _}from"./app-e4jMZ1A-.js";/* empty css            */function L(){const[g,p]=s.useState(!1),[f,j]=s.useState(""),[b,y]=s.useState([]),[l,h]=s.useState(!1);s.useEffect(()=>{fetch("https://stahnmpukuturan.ac.id/api/cekprodi.php").then(e=>e.json()).then(e=>{e.success?y(e.data):console.error("Data prodi tidak ditemukan")}).catch(e=>console.error("Error:",e))},[]);const[t,o]=s.useState({id_layanan:"",nama_pemohon:"",nim:"",nik:"",identitas_pengguna:"",prodi:"",alamat:"",kategori_pengguna:"alumni",no_hp:"",email:"",keterangan_tambahan:"",judul_layanan:"",file_lampiran:null}),[d,k]=s.useState({}),[c,N]=s.useState(""),i=e=>{const{name:n,value:r,files:m}=e.target;o(u=>({...u,[n]:m?m[0]:r,...n==="nik"&&{identitas_pengguna:r},kategori_pengguna:"alumni"}))},v=async()=>{if(!t.nik||!t.prodi){alert("Mohon isi NIK dan Prodi terlebih dahulu.");return}console.log(t.identitas_pengguna);try{const n=await(await fetch("https://stahnmpukuturan.ac.id/api/cekalumni.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nik:t.nik,id_prodi:t.prodi})})).json();n&&n.user&&n.user.nama?(o(r=>({...r,nama_pemohon:n.user.nama,alamat:n.user.jln||"",no_hp:n.user.phone||"",email:n.user.email||""})),j(n.user.status==="LULUS"?"LULUS":"NONAKTIF"),p(!0)):(p(!1),alert("Data Alumni tidak ditemukan."))}catch(e){console.error("Gagal mengambil data:",e),alert("Terjadi kesalahan saat mengambil data.")}},w=async e=>{e.preventDefault(),h(!0);try{const n=new FormData;Object.entries(t).forEach(([m,u])=>{n.append(m,u)});const r=await x.post(route("permohonanlayanan"),n,{headers:{"Content-Type":"multipart/form-data"}});alert("Data berhasil dikirim dengan nomor tiket: "+r.data.tiket.no_tiket),_.visit(route("detailTiket",{no_tiket:r.data.tiket.no_tiket}))}catch(n){n.response?.status===422?alert(`Validasi gagal:
`+JSON.stringify(n.response.data.errors)):alert("Terjadi kesalahan saat mengirim data.")}finally{h(!1)}};return s.useEffect(()=>{x.get("/layanan/alumni").then(e=>{Array.isArray(e.data)?k(e.data):console.error("Format data tidak valid:",e.data)}).catch(e=>{console.error("Gagal memuat data layanan:",e)})},[]),a.jsxs("div",{className:"pt-40 px-4 pb-20",children:[a.jsx("div",{className:"max-w-4xl mx-auto",children:a.jsx("div",{className:"card bg-base-100 shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h2",{className:"card-title text-center text-2xl font-bold",children:"Form Permohonan Layanan Alumni"}),a.jsx("span",{className:"text-sm text-gray-500 mb-2",children:"Silakan isi form berikut untuk memulai permohonan layanan."}),a.jsxs("form",{onSubmit:w,className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Informasi Alumni"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("select",{name:"prodi",value:t.prodi,onChange:e=>o({...t,prodi:e.target.value}),className:"border p-2 rounded",required:!0,children:[a.jsx("option",{value:"",children:"Pilih Prodi"}),b.map(e=>a.jsx("option",{value:e.id_prodi,children:e.nama_prodi},e.id_prodi))]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",required:!0,name:"nik",value:t.nik,onChange:i,className:"input input-bordered flex-1",placeholder:"NIK"}),a.jsx("button",{type:"button",className:"btn btn-accent whitespace-nowrap",onClick:v,children:"Cek"})]}),a.jsx("input",{type:"text",required:!0,name:"nama_pemohon",value:t.nama_pemohon,onChange:i,className:"input input-bordered w-full",placeholder:"Nama Lengkap",readOnly:!0}),a.jsx("input",{type:"text",required:!0,name:"no_hp",value:t.no_hp,onChange:i,className:"input input-bordered w-full",placeholder:"No. HP"}),a.jsx("input",{type:"email",required:!0,name:"email",value:t.email,onChange:i,className:"input input-bordered w-full",placeholder:"Email (untuk mendapatkan notifikasi)"}),a.jsx("textarea",{name:"alamat",value:t.alamat,onChange:i,className:"textarea textarea-bordered w-full",placeholder:"Alamat Lengkap",rows:"2",required:!0})]})]}),g&&f==="LULUS"&&a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Rincian Permohonan"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("select",{name:"id_layanan",className:"select select-bordered w-full",value:c,onChange:e=>{N(e.target.value),o({...t,id_layanan:e.target.value,judul_layanan:d.find(n=>n.id.toString()===e.target.value)?.nama_layanan||""})},children:[a.jsx("option",{value:"",disabled:!0,children:"Pilih Layanan"}),d.map(e=>a.jsx("option",{value:e.id,children:e.nama_layanan},e.id))]}),c&&a.jsxs("div",{className:"mt-4 bg-gray-100 p-4 rounded shadow",children:[a.jsxs("h3",{className:"font-semibold mb-2",children:["Persyaratan untuk layanan"," ",d.find(e=>e.id.toString()===c)?.nama_layanan]}),a.jsx("ul",{className:"list-disc list-inside",children:d.find(e=>e.id.toString()===c)?.persyaratan.map((e,n)=>a.jsx("li",{children:e},n))})]}),a.jsx("textarea",{name:"keterangan_tambahan",value:t.keterangan_tambahan,onChange:i,className:"textarea textarea-bordered w-full",placeholder:"Rincian Informasi yang Dibutuhkan",rows:"3",required:!0}),a.jsxs("div",{className:"form-control md:col-span-2",children:[a.jsx("label",{className:"label",children:"Unggah berkas pendukung"}),a.jsx("input",{type:"file",name:"file_lampiran",onChange:i,accept:".pdf",className:"file-input file-input-bordered w-full",required:!0})]}),a.jsx("div",{className:"card-actions justify-end pt-4",children:a.jsx("button",{type:"submit",disabled:l,className:`px-4 py-2 rounded text-white ${l?"bg-gray-400":"bg-green-500 hover:bg-green-600"}`,children:l?"Mengirim...":"Kirim"})})]})]})]})]})})}),l&&a.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center z-10",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsxs("svg",{className:"animate-spin h-10 w-10 text-green-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8h4z"})]}),a.jsx("span",{className:"mt-2 text-green-600 font-semibold",children:"Mengirim data..."})]})})]})}export{L as default};
