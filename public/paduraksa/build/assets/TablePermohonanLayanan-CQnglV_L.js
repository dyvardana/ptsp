import{r as t,a as F,j as e,c}from"./app-e4jMZ1A-.js";import"./index-BP5ZlSPo.js";import{C as W,a as Y}from"./clock-BGq8o9Ho.js";import{a as Z,L as ee,C as ae,E as se}from"./loader-circle-CX3sZwgb.js";/* empty css            */import"./createLucideIcon-B64HR7v-.js";function xe({data:m,staff:z}){const[w,A]=t.useState(m);t.useEffect(()=>{A(m)},[m]);const j=F().props.auth.user,r=10,[g,E]=t.useState(""),[l,h]=t.useState(1),[s,S]=t.useState(null),[I,b]=t.useState(!1),[B,u]=t.useState(!1),[T,y]=t.useState(""),[f,d]=t.useState(""),[U,C]=t.useState(""),[p,v]=t.useState(""),[R,x]=t.useState(!1),[te,ne]=t.useState(null),[_,L]=t.useState(""),[k,P]=t.useState(""),[le,ie]=t.useState(F().props.staff||[]),[$,G]=t.useState(null),[M,H]=t.useState(null),[D,J]=t.useState(null),o=t.useMemo(()=>w.filter(a=>Object.values(a).some(n=>n?.toString().toLowerCase().includes(g.toLowerCase()))),[g,w]),O=t.useMemo(()=>{const a=(l-1)*r;return o.slice(a,a+r)},[o,l]),N=Math.ceil(o.length/r),X=a=>{S(a),b(!0)},i=()=>{S(null),b(!1),u(!1),y("")},q=()=>{c.post(route("tolak"),{id:f,email:U,keterangan_tiket:T,idUser:j.id,no_tiket:p},{onSuccess:()=>{u(!1),c.reload({only:["data","statusData"]})}})},Q=()=>{c.post(route("terima"),{id:f,idUser:j.id,no_tiket:p},{onSuccess:()=>{c.reload({only:["data","statusData"]})}})},V=()=>{if(!k){alert("Pilih staff terlebih dahulu.");return}const a=new FormData;a.append("id",f),a.append("idUser",j.id),a.append("no_tiket",p),a.append("id_staff",k),a.append("catatan",_),console.log("form data:",a),c.post(route("tindakLanjut"),a,{forceFormData:!0,onSuccess:()=>{x(!1),P(""),L(""),i(),c.reload({only:["data"]})}})},K=async a=>{try{const n=await axios.post("cekTindakLanjut",{id_permohonan:a});console.log("response axios:",n.data),H(n.data.name),G(n.data.updated_at),J(n.data.created_at)}catch(n){console.error("Gagal mengambil data:",n)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mockup-window border border-base-300 bg-base-100 p-2 sm:p-4",children:[e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Permohonan Masuk"}),e.jsx("input",{type:"text",placeholder:"Cari...",className:"input input-bordered input-sm w-full max-w-xs",value:g,onChange:a=>{E(a.target.value),h(1)}})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"table table-xs w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Tiket"}),e.jsx("th",{className:"hidden sm:table-cell",children:"Nama"}),e.jsx("th",{className:"hidden md:table-cell",children:"Kategori"}),e.jsx("th",{className:"hidden lg:table-cell",children:"Layanan"}),e.jsx("th",{className:"hidden lg:table-cell",children:"Tanggal Pengajuan"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"hidden md:table-cell",children:"Rating"}),e.jsx("th",{children:"Pilihan"})]})}),e.jsx("tbody",{children:O.map((a,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:(l-1)*r+n+1}),e.jsx("td",{children:a.no_tiket}),e.jsx("td",{className:"hidden sm:table-cell",children:a.nama_pemohon}),e.jsx("td",{className:"hidden md:table-cell",children:a.kategori_pengguna}),e.jsx("td",{className:"hidden lg:table-cell",children:a.nama_layanan}),e.jsx("td",{className:"hidden lg:table-cell",children:a.tanggal_pengajuan}),e.jsx("td",{children:e.jsxs("span",{className:a.status==="menunggu"?"badge-xs badge badge-neutral flex items-center gap-1":a.status==="diproses"?"badge-xs badge badge-warning flex items-center gap-1":a.status==="diterima"?"badge-xs badge badge-info flex items-center gap-1":a.status==="selesai"?"badge-xs badge badge-success flex items-center gap-1":a.status==="ditolak"?"badge-xs badge badge-error flex items-center gap-1":"badge",children:[a.status==="menunggu"&&e.jsx(W,{size:14}),a.status==="diproses"&&e.jsx(Z,{size:14,className:"animate-spin"}),a.status==="diterima"&&e.jsx(ee,{size:14}),a.status==="selesai"&&e.jsx(Y,{size:14}),a.status==="ditolak"&&e.jsx(ae,{size:14}),e.jsx("span",{className:"capitalize",children:a.status})]})}),e.jsx("td",{className:"hidden md:table-cell",children:a.rating?"★".repeat(Math.round(a.rating))+"☆".repeat(5-Math.round(a.rating)):null}),e.jsx("td",{children:e.jsxs("button",{className:"btn btn-xs btn-accent",onClick:()=>{X(a),K(a.id),d(a.id),C(a.email),v(a.no_tiket)},children:[e.jsx(se,{})," Detail"]})})]},a.id))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm",children:["Menampilkan ",(l-1)*r+1," -"," ",Math.min(l*r,o.length)," ","dari ",o.length]}),e.jsxs("div",{className:"join",children:[e.jsx("button",{className:"join-item btn btn-sm",disabled:l===1,onClick:()=>h(a=>Math.max(a-1,1)),children:"«"}),Array.from({length:N},(a,n)=>e.jsx("button",{className:`join-item btn btn-sm ${l===n+1?"btn-active":""}`,onClick:()=>h(n+1),children:n+1},n)),e.jsx("button",{className:"join-item btn btn-sm",disabled:l===N,onClick:()=>h(a=>Math.min(a+1,N)),children:"»"})]})]})]}),I&&s&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg shadow-lg w-full max-w-5xl flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"w-full md:w-1/2 h-[300px] md:h-[500px] border rounded overflow-hidden",children:s.file_lampiran?e.jsx("iframe",{src:`/storage/${s.file_lampiran}`,className:"w-full h-full",title:"Preview PDF"}):e.jsx("div",{className:"text-center p-4",children:"Tidak ada file yang diunggah."})}),e.jsxs("div",{className:"w-full md:w-1/2 overflow-y-auto max-h-[300px] md:max-h-[500px]",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Detail Pengajuan"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"No Tiket:"})," ",s.no_tiket??"Belum ada tiket"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Nama:"})," ",s.nama_pemohon]}),e.jsxs("li",{children:[e.jsx("strong",{children:"NIK/NIM:"})," ",s.identitas_pengguna]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("li",{children:[e.jsx("strong",{children:"No HP:"})," ",s.no_hp]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Alamat:"})," ",s.alamat]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Kategori:"})," ",s.kategori_pengguna]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Layanan:"})," ",s.nama_layanan]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Judul Layanan:"})," ",s.judul_layanan]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tanggal Pengajuan:"})," ",s.tanggal_pengajuan]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Keterangan:"})," ",s.keterangan_tambahan]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:s.status==="diproses"?"text-yellow-500":s.status==="menunggu"?"text-gray-800":s.status==="diterima"?"text-blue-500":s.status==="selesai"?"text-green-500":s.status==="ditolak"?"text-red-500":"",children:s.status})]}),s.status==="ditolak"?e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Alasan Penolakan:"})," ",s.keterangan_tiket]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Admin:"})," ",s.name]})]}):s.status==="diproses"?e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Admin:"})," ",s.name]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Staff:"})," ",M]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tindak Lanjut:"})," ",D]})]}):s.status==="selesai"?e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Admin:"})," ",s.name]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tindak Lanjut:"})," ",D]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tgl Selesai:"})," ",$]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Staff:"})," ",M]})]}):null]}),e.jsx("div",{className:"mt-6 flex flex-wrap justify-end gap-2",children:s.status==="ditolak"?e.jsx("button",{className:"btn",onClick:()=>{i(),d("")},children:"Tutup"}):s.status==="diterima"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>x(!0),children:"Teruskan Ke Staff"}),e.jsx("button",{className:"btn",onClick:()=>{i(),d("")},children:"Tutup"})]}):s.status==="diproses"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>x(!0),children:"Ubah Tujuan"}),e.jsx("button",{className:"btn",onClick:()=>{i(),d("")},children:"Tutup"})]}):s.status==="selesai"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success",onClick:K,children:"Lihat Tindak Lanjut"}),e.jsx("button",{className:"btn",onClick:()=>{i(),d(""),C(""),v("")},children:"Tutup"})]}):s.status==="menunggu"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-error",onClick:()=>{b(!1),u(!0)},children:"Tolak Pengajuan"}),e.jsx("button",{className:"btn btn-accent",onClick:()=>{i(),Q()},children:"Terima Pengajuan"}),e.jsx("button",{className:"btn",onClick:()=>{i(),d("")},children:"Tutup"})]}):null})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg w-full max-w-md shadow-lg",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Alasan Penolakan"}),e.jsx("textarea",{className:"textarea textarea-bordered w-full mb-4",rows:"4",placeholder:"Tuliskan alasan penolakan...",value:T,onChange:a=>y(a.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>u(!1),children:"Batal"}),e.jsx("button",{className:"btn btn-error",onClick:()=>{q()},children:"Kirim"})]})]})}),R&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg w-full max-w-md shadow-lg",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Teruskan ke Staff"}),e.jsxs("select",{className:"select  select-bordered w-full mb-4",value:k,onChange:a=>P(a.target.value),children:[e.jsx("option",{value:"",children:"Pilih Staff"}),z.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx("textarea",{className:"textarea  textarea-bordered w-full mb-4",rows:"4",placeholder:"Catatan tambahan...",value:_,onChange:a=>L(a.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>x(!1),children:"Batal"}),e.jsx("button",{className:"btn btn-success",onClick:V,children:"Teruskan"})]})]})})]})}export{xe as default};
