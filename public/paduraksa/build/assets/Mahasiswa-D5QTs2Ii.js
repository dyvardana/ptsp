import{r as i,b as h,j as a,c as w}from"./app-e4jMZ1A-.js";import{c as v}from"./createLucideIcon-B64HR7v-.js";/* empty css            *//**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],C=v("triangle-alert",_);function I(){const[x,u]=i.useState(!1),[g,y]=i.useState(""),[l,p]=i.useState(!1),[n,c]=i.useState({id_layanan:"",nama_pemohon:"",nim:"",identitas_pengguna:"",alamat:"",kategori_pengguna:"mahasiswa",no_hp:"",email:"",keterangan_tambahan:"",judul_layanan:"",file_lampiran:null}),[d,f]=i.useState({}),[o,j]=i.useState(""),s=e=>{const{name:t,value:r,files:m}=e.target;c({...n,[t]:m?m[0]:r})},b=async()=>{if(!n.nik||!n.identitas_pengguna){alert("Harap lengkapi NIK dan NIM terlebih dahulu.");return}try{const t=await(await fetch("https://stahnmpukuturan.ac.id/api/cekmahasiswa.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nik:n.nik,nipd:n.identitas_pengguna})})).json();t&&t.user&&t.user.nama?(c(r=>({...r,nama_pemohon:t.user.nama,alamat:t.user.jln||"",no_hp:t.user.phone||"",email:t.user.email||""})),y(t.user.status==="AKTIF"?"AKTIF":"NONAKTIF"),u(!0)):(u(!1),alert("Data mahasiswa tidak ditemukan."))}catch(e){console.error("Gagal mengambil data:",e),alert("Terjadi kesalahan saat mengambil data.")}},N=async e=>{e.preventDefault(),p(!0);try{const t=new FormData;Object.entries(n).forEach(([m,k])=>{t.append(m,k)});const r=await h.post(route("permohonanlayanan"),t,{headers:{"Content-Type":"multipart/form-data"}});alert("Data berhasil dikirim dengan nomor tiket: "+r.data.tiket.no_tiket),w.visit(route("detailTiket",{no_tiket:r.data.tiket.no_tiket}))}catch(t){t.response?.status===422?alert(`Validasi gagal:
`+JSON.stringify(t.response.data.errors)):alert("Terjadi kesalahan saat mengirim data.")}finally{p(!1)}};return i.useEffect(()=>{h.get("/layanan/mahasiswa").then(e=>{Array.isArray(e.data)?f(e.data):console.error("Format data tidak valid:",e.data)}).catch(e=>{console.error("Gagal memuat data layanan:",e)})},[]),a.jsxs("div",{className:"pt-40 px-4 pb-20",children:[a.jsx("div",{className:"max-w-4xl mx-auto",children:a.jsx("div",{className:"card bg-base-100 shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h2",{className:"card-title text-center text-2xl font-bold",children:"Form Permohonan Layanan Mahasiswa"}),a.jsx("span",{className:"text-sm text-gray-500 mb-2",children:"Silakan isi form berikut untuk memulai permohonan layanan. Data diri harus lengkap dan apabila terdapat perbedaan silahkan melakukan peremajaan pada akun SISKA."}),a.jsxs("form",{onSubmit:N,className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Informasi Diri Mahasiswa"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",name:"identitas_pengguna",value:n.identitas_pengguna,onChange:s,className:"input input-bordered w-full",placeholder:"NIM",required:!0}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",name:"nik",value:n.nik,onChange:s,className:"input input-bordered flex-1",placeholder:"NIK KTP",required:!0}),a.jsx("button",{type:"button",className:"btn btn-accent whitespace-nowrap",onClick:b,children:"Cek"})]}),a.jsx("input",{type:"text",name:"nama_pemohon",value:n.nama_pemohon,onChange:s,className:"input input-bordered w-full",placeholder:"Nama Lengkap",readOnly:!0,required:!0}),a.jsx("input",{type:"text",name:"no_hp",value:n.no_hp,onChange:s,className:"input input-bordered w-full",placeholder:"No. HP",readOnly:!0,required:!0}),a.jsx("input",{type:"email",name:"email",value:n.email,onChange:s,className:"input input-bordered w-full",placeholder:"Email",readOnly:!0}),a.jsx("textarea",{name:"alamat",value:n.alamat,onChange:s,className:"textarea textarea-bordered w-full",placeholder:"Alamat Lengkap",rows:"2",readOnly:!0,required:!0})]})]}),x&&g==="AKTIF"&&a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Rincian Permohonan"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("select",{name:"id_layanan",className:"select select-bordered w-full",value:o,onChange:e=>{j(e.target.value),c({...n,id_layanan:e.target.value,judul_layanan:d.find(t=>t.id.toString()===e.target.value)?.nama_layanan||""})},children:[a.jsx("option",{value:"",disabled:!0,children:"Pilih Layanan"}),d.map(e=>a.jsx("option",{value:e.id,children:e.nama_layanan},e.id))]}),o&&a.jsxs("div",{className:"mt-4 bg-gray-100 p-4 rounded shadow",children:[a.jsxs("h3",{className:"font-semibold mb-2",children:["Persyaratan untuk layanan"," ",d.find(e=>e.id.toString()===o)?.nama_layanan]}),a.jsx("ul",{className:"list-disc list-inside",children:d.find(e=>e.id.toString()===o)?.persyaratan.map((e,t)=>a.jsx("li",{children:e},t))}),a.jsx("hr",{className:"my-3"}),a.jsxs("div",{className:"flex items-start gap-2 bg-yellow-50 p-3 rounded-md border border-yellow-200",children:[a.jsx(C,{className:"text-yellow-800 mt-1"}),a.jsxs("p",{className:"text-sm",children:[a.jsx("strong",{children:"Catatan:"})," ",a.jsx("i",{children:"Pastikan semua persyaratan telah dipenuhi sebelum mengirim permohonan dan dijadikan satu file .pdf / .zip."})]})]})]}),a.jsx("textarea",{name:"keterangan_tambahan",value:n.keterangan_tambahan,onChange:s,className:"textarea textarea-bordered w-full",placeholder:"Rincian Informasi yang Dibutuhkan",rows:"3",required:!0}),a.jsxs("div",{className:"form-control md:col-span-2",children:[a.jsx("label",{className:"label",children:"Unggah berkas pendukung"}),a.jsx("input",{type:"file",name:"file_lampiran",onChange:s,accept:".pdf,.rar,.zip",className:"file-input file-input-bordered w-full",required:!0})]}),a.jsx("div",{className:"card-actions justify-end pt-4",children:a.jsx("button",{type:"submit",disabled:l,className:`px-4 py-2 rounded text-white ${l?"bg-gray-400":"bg-green-500 hover:bg-green-600"}`,children:l?"Mengirim...":"Kirim"})})]})]})]})]})})}),l&&a.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center z-10",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsxs("svg",{className:"animate-spin h-10 w-10 text-green-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8h4z"})]}),a.jsx("span",{className:"mt-2 text-green-600 font-semibold",children:"Mengirim data..."})]})})]})}export{I as default};
